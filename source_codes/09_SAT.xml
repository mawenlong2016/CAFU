<tool id="SAT" name="SAT">
  <description> 
  </description>
  <command>
	  mkdir -p /home/chenzhuod/galaxy/database/files/SAT ;
	  cat $training.posCdsFa > /home/chenzhuod/galaxy/database/files/SAT/positive_cds.fa ;
	  cat $training.negCdsFa > /home/chenzhuod/galaxy/database/files/SAT/negative_cds.fa ;
	  #if $training.background.yes_or_no == "yes"
		  cat $training.background.posBGFa > /home/chenzhuod/galaxy/database/files/SAT/positive_dna.fa ;
		  cat $training.background.negBGFa > /home/chenzhuod/galaxy/database/files/SAT/negative_dna.fa ;
	  #end if
	  cat $test.candidateFa > /home/chenzhuod/galaxy/database/files/SAT/test.fa ;
	  
	  /usr/bin/python /home/chenzhuod/galaxy/tools/CAFU/SAT/gcForest_hexamer.py -positive /home/chenzhuod/galaxy/database/files/SAT/positive_cds.fa -negative /home/chenzhuod/galaxy/database/files/SAT/negative_cds.fa -candidates /home/chenzhuod/galaxy/database/files/SAT/test.fa
	  #if $training.background.yes_or_no == "yes"
	  -posBG /home/chenzhuod/galaxy/database/files/SAT/positive_dna.fa -negBG /home/chenzhuod/galaxy/database/files/SAT/negative_dna.fa
	  #end if
	  -out /home/chenzhuod/galaxy/database/files/SAT/ -t $parameters.cpu -k $parameters.KFold -threshold $parameters.cuf_off;
	  
	  cat /home/chenzhuod/galaxy/database/files/SAT/mixed_transcripts_predict.txt > $predictRes ;
	  cat /home/chenzhuod/galaxy/database/files/SAT/Fscore.pdf > $Fscore ;
	  cat /home/chenzhuod/galaxy/database/files/SAT/measures.pdf > $measures ;
	  cat /home/chenzhuod/galaxy/database/files/SAT/precision_recall.pdf > $precision_recall ;
	  cat /home/chenzhuod/galaxy/database/files/SAT/ROC.pdf > $ROC ;

  </command>
  <inputs>
	  <section name="training" title="training sequences" expanded="True">
		  <param name="posCdsFa" type="data" label="The positive CDS sequences (.fasta)" />
		  <param name="negCdsFa" type="data" label="The negative CDS sequences (.fasta)" />
		  <conditional name="background">
			  <param name="yes_or_no" type="select" label="Background sequences">
				  <option value="yes">input background sequences by users</option>
				  <option value="no" selected="true">generated by SAT (input nothing)</option>
			  </param>
			  <when value="yes">
				  <param name="posBGFa" type="data" label="The positive background sequences (.fasta)" />
				  <param name="negBGFa" type="data" label="The negative background sequences (.fasta)" />
			  </when>
			  <when value="no">
			  </when>
		  </conditional>
	  </section>
	  <section name="test" title="test sequences" expanded="True">
		  <param name="candidateFa" type="data" label="The mixed coding sequences (.fasta)" />
	  </section>
	  <section name="parameters" title="SAT parameters" expanded="True">
		  <param name="KFold" type="integer" value="10" label="K-fold" />
		  <param name="cpu" type="integer" value="3" min="1" label="Threads" />
		  <param name="cuf_off" type="float" value="0.5" min="0" max="1" label="Classifying threshold" />
	  </section>
  </inputs>
  <stdio>
	  <exit_code range="1:"  level="fatal" description="Error Running SAT" />
  </stdio>
  <outputs>
	  <data name="predictRes" format="txt" label="Probalistic score of each transcript"/>
	  <data name="Fscore" format="pdf" label="The F1-score under different threshold"/>
	  <data name="measures" format="pdf" label="Six commonly used measures under specified threshold"/>
	  <data name="precision_recall" format="pdf" label="The presicion recall curves in k-fold cross validation"/>
	  <data name="ROC" format="pdf" label="The receiver operating curves in k-fold cross validation"/>

  </outputs>
    <help>
.. class:: infomark

**What it does**
		  
SAT (Species Assignment of TRanscripts) is a machine learning-based toolkit used for species assignment of transcritps assembled using unmapped reads from mixed-species (eg., pathogen-host) samples.
.. class:: infomark

**Inputs**
 * Pathogen coding sequences.
 * Host coding sequences.
 * Candidate codign sequences.

.. class:: infomark

**Outputs**
 * Assigned probabilistic score of each transcript.
 * Evaluation results (plots).
 
	The F1-score under different threshold.
	
	Six commonly used measures under specified threshold.
	
	The presicion recall curves in k-fold cross validation.
	
	The receiver operating curves in k-fold cross validation.	

.. class:: infomark

**Parameters**
 * K-fold : The k-fold cross validation;
 * CPU : The number of threads uesd for training;
 * Classifying threshold: The threshold used for classifying transcripts;
   </help>

</tool>

